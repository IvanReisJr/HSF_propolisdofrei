{% extends "base.html" %}

{% block title %}
    {% if is_edit %}
        Editar Unidade
    {% else %}
        Nova Unidade
    {% endif %}
    - Própolis do Frei
{% endblock %}

{% block breadcrumbs %}
<span style="color: #a3a3a3;">Início / Unidades / </span> 
<span style="font-weight: 600;">
    {% if is_edit %}
        Editar
    {% else %}
        Nova
    {% endif %}
</span>
{% endblock %}

{% block content %}
<div class="flex-col gap-6" style="max-width: 800px; margin: 0 auto;">
    <div class="flex items-center gap-4">
        <a href="{% url 'establishment_list' %}" class="btn btn-outline p-2">
            <i data-lucide="arrow-left"></i>
        </a>
        <h1 style="font-size: 1.875rem; font-weight: 700;">
            {% if is_edit %}
                Configurar Unidade
            {% else %}
                Nova Unidade
            {% endif %}
        </h1>
    </div>

    <form method="post" class="card flex-col gap-6">
        {% csrf_token %}

        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 1.5rem;">
            <div class="flex-col gap-2">
                <label class="label">Código Interno</label>
                {% if is_edit %}
                    <input type="text" name="code" value="{{ establishment.code }}" class="input" placeholder="Ex: UNIT001" required>
                {% else %}
                    <input type="text" value="{{ next_code }}" class="input" disabled style="background: #f3f4f6; color: #666;">
                    <input type="hidden" name="code" value="{{ next_code }}">
                    <p style="font-size: 0.75rem; color: #666; margin-top: 0.25rem;">Código gerado automaticamente</p>
                {% endif %}
            </div>
            <div class="flex-col gap-2">
                <label class="label">Nome da Unidade</label>
                <input type="text" name="name" value="{{ establishment.name }}" class="input" placeholder="Ex: HSF Taubaté" required>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem;">
            <div class="flex-col gap-2">
                <label class="label">Cidade</label>
                <input type="text" name="city" value="{{ establishment.city }}" class="input" placeholder="Ex: Taubaté" required>
            </div>
            <div class="flex-col gap-2">
                <label class="label">Estado (UF)</label>
                <select name="state" class="input" required>
                    <option value="">Selecione...</option>
                    {% for state_code, state_name in states %}
                        {% if establishment.state == state_code %}
                            <option value="{{ state_code }}" selected>
                                {{ state_name }} ({{ state_code }})
                            </option>
                        {% else %}
                            <option value="{{ state_code }}">
                                {{ state_name }} ({{ state_code }})
                            </option>
                        {% endif %}
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="flex-col gap-2">
            <label class="label">Endereço Completo</label>
            <input type="text" name="address" value="{{ establishment.address }}" class="input" placeholder="Rua, Número, Bairro">
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
            <div class="flex-col gap-2">
                <label class="label">Telefone de Contato</label>
                <input type="text" name="phone" value="{{ establishment.phone }}" class="input" placeholder="(12) 0000-0000">
            </div>
            <div class="flex-col gap-2">
                <label class="label">E-mail da Unidade</label>
                <input type="email" name="email" value="{{ establishment.email }}" class="input" placeholder="unidade@hsf.com">
            </div>
        </div>

        <div class="flex items-center gap-3">
            <input type="checkbox" name="is_active" id="id_is_active" 
                {% if establishment.is_active or not is_edit %}
                    checked
                {% endif %} 
                style="width: 18px; height: 18px; cursor: pointer;">
            <label for="id_is_active" style="font-weight: 600; cursor: pointer;">Unidade Habilitada e Em Operação</label>
        </div>

        <div class="flex justify-end gap-3" style="border-top: 1px solid var(--border); padding-top: 1.5rem; margin-top: 1rem;">
            <a href="{% url 'establishment_list' %}" class="btn btn-outline">Cancelar</a>
            <button type="submit" class="btn btn-primary">
                <i data-lucide="save"></i> Salvar Unidade
            </button>
        </div>
    </form>
</div>

<style>
    .label {
        font-size: 0.875rem;
        font-weight: 600;
        color: #404040;
    }
</style>
{% endblock %}