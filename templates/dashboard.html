{% extends "base.html" %}

{% block title %}Dashboard - Própolis do Frei{% endblock %}

{% block breadcrumbs %}
<span style="color: #a3a3a3;">Início / </span> <span style="font-weight: 600;">Dashboard</span>
{% endblock %}

{% block content %}
<div class="flex-col gap-6 animate-enter">

    <!-- Hero Section: Sovereign Light & Textured -->
    <div class="card p-6 relative overflow-hidden"
        style="background: linear-gradient(135deg, #FFF8E1 0%, #F3E5AB 100%); color: #4B3621; border: 1px solid #D4AF37;">
        <!-- Texture Overlay (Subtle Pattern) -->
        <div
            style="position: absolute; inset: 0; opacity: 0.4; background-image: url('data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cg fill=\'none\' fill-rule=\'evenodd\'%3E%3Cg fill=\'%23D4AF37\' fill-opacity=\'0.2\'%3E%3Cpath d=\'M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E'); pointer-events: none;">
        </div>

        <div class="flex justify-between items-end relative z-10">
            <div>
                <p
                    style="color: #92400E; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; font-size: 0.75rem; margin-bottom: 0.5rem; display: flex; items-center; gap: 0.5rem;">
                    <i data-lucide="sun" style="width: 14px; color: #D4AF37;"></i> Painel de Controle
                </p>
                <h1
                    style="font-size: 2.5rem; font-weight: 800; line-height: 1.1; letter-spacing: -0.03em; margin-bottom: 0.5rem; color: #4B3621;">
                    Olá, {{ user.first_name }}
                </h1>
                <p style="color: #78350F; max-width: 700px; font-weight: 500;">
                    Gestão ativa da unidade <strong style="color: #B45309;">{{ user.distributor.name|default:"Geral"
                        }}</strong>. Você tem <strong
                        style="color: #B45309; background: rgba(255,255,255,0.5); padding: 0 4px; border-radius: 2px;">{{
                        stats.pending_orders|default:"0" }} distribuições</strong> pendentes hoje.
                </p>

                <div class="flex gap-3 mt-6">
                    <a href="/products/new/" class="btn hover-lift hover-glow"
                        style="background: #4B3621; color: #FFF8E1; border: none; border-radius: 2px; box-shadow: 0 4px 6px -1px rgba(75, 54, 33, 0.2);">
                        <i data-lucide="plus" style="width: 18px;"></i> Novo Produto
                    </a>
                    <a href="/orders/new/" class="btn hover-lift"
                        style="color: #4B3621; border: 1px solid #B45309; background: rgba(255,255,255,0.6);">
                        <i data-lucide="send" style="width: 18px;"></i> Nova Distribuição
                    </a>
                </div>
            </div>

            <!-- Heavenly Light Element -->
            <div
                style="position: absolute; right: -40px; top: -60px; width: 300px; height: 300px; background: radial-gradient(circle, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0) 70%); border-radius: 50%; opacity: 0.6; pointer-events: none; mix-blend-mode: overlay;">
            </div>
        </div>
    </div>
</div>

<!-- Stats Grid: Broken Symmetry (3 + 1 Big) -->
<div style="display: grid; grid-template-columns: repeat(3, 1fr) 1.5fr; gap: 1rem;">

    <!-- Stat 1 -->
    <a href="{% url 'product_list' %}" class="card p-4 hover-lift stats-card"
        style="border-left: 2px solid var(--primary); text-decoration: none; color: inherit; display: block;">
        <div class="flex justify-between items-start mb-2">
            <span class="label">Produtos Ativos</span>
            <i data-lucide="package" style="color: var(--primary); width: 16px; opacity: 0.7;"></i>
        </div>
        <div class="stats-value" style="font-size: 1.75rem; font-weight: 800;">{{ stats.products_count }}</div>
        <div style="font-size: 0.75rem; color: var(--success); font-weight: 600;">+2.4% <span
                style="color: #999; font-weight: 400;">vs mês passado</span></div>
    </a>

    <!-- Stat 2 -->
    <div class="card p-4 hover-lift stats-card" style="border-left: 2px solid #DC2626;">
        <div class="flex justify-between items-start mb-2">
            <span class="label">Estoque Crítico</span>
            <i data-lucide="alert-triangle" style="color: #DC2626; width: 16px; opacity: 0.7;"></i>
        </div>
        <div class="stats-value" style="font-size: 1.75rem; font-weight: 800;">{{ stats.low_stock_count }}</div>
        <div style="font-size: 0.75rem; color: #DC2626; font-weight: 600;">Ação necessária</div>
    </div>

    <!-- Stat 3 -->
    <div class="card p-4 hover-lift stats-card" style="border-left: 2px solid #2563EB;">
        <div class="flex justify-between items-start mb-2">
            <span class="label">Movimentações</span>
            <i data-lucide="activity" style="color: #2563EB; width: 16px; opacity: 0.7;"></i>
        </div>
        <div class="stats-value" style="font-size: 1.75rem; font-weight: 800;">{{ stats.movements_count }}</div>
        <div style="font-size: 0.75rem; color: #A3A3A3;">Últimas 24h</div>
    </div>

    <!-- Big Stat (Asymmetric Focus) -->
    <div class="card p-4 hover-lift relative overflow-hidden flex flex-col justify-center"
        style="background: linear-gradient(to right, #111, #1A1A1A); color: white; border: 1px solid #333;">
        <div style="position: absolute; right: -10px; bottom: -10px; opacity: 0.1;">
            <i data-lucide="bar-chart-2" style="width: 100px; height: 100px;"></i>
        </div>
        <div class="label" style="color: #888;">Faturamento Mensal (Est.)</div>
        <div class="flex items-baseline gap-2">
            <span style="font-size: 2.25rem; font-weight: 800; color: #D4AF37;">R$ 45.280</span>
            <span style="color: var(--success); font-weight: 600; font-size: 0.875rem;">▲ 12%</span>
        </div>
        <div
            style="height: 4px; width: 100%; background: #333; margin-top: 1rem; border-radius: 99px; overflow: hidden;">
            <div style="height: 100%; width: 75%; background: #D4AF37;"></div>
        </div>
    </div>
</div>

<!-- Bottom Section: 2-column grid (Recent Orders + Action Cards) -->
<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem;">
    <!-- Recent Orders (Left column) -->
    <div class="card">
        <div class="flex justify-between items-center mb-6">
            <h3 style="font-size: 1.125rem; font-weight: 700;">Distribuições Recentes</h3>
            <a href="/orders/"
                style="font-size: 0.75rem; font-weight: 600; color: var(--primary); text-transform: uppercase; letter-spacing: 0.05em;">Ver
                Todas →</a>
        </div>

        <div style="overflow-x: hidden;">
            <table style="width: 100%; border-collapse: separate; border-spacing: 0;">
                <tbody>
                    {% for order in recent_orders|slice:":3" %}
                    <tr class="hover-bg-gray-50 transition-colors" style="cursor: pointer;"
                        onclick="window.location='/orders/{{ order.id }}/'">
                        <td style="padding: 1rem 0; border-bottom: 1px solid #f1f1f1;">
                            <div style="font-family: var(--font-mono); font-weight: 600; color: #111;">
                                {{ order.order_number }}</div>
                            <div style="font-size: 0.75rem; color: #888;">{{ order.created_at|date:"d/m H:i" }}
                            </div>
                        </td>
                        <td style="padding: 1rem 0; border-bottom: 1px solid #f1f1f1;">
                            <div style="font-weight: 600;">{{ order.distributor.name }}</div>
                            <div style="font-size: 0.75rem; color: #888;">{{ order.items.count }} itens</div>
                        </td>
                        <td style="padding: 1rem 0; border-bottom: 1px solid #f1f1f1;">
                            <span
                                style="padding: 0.25rem 0.5rem; border-radius: 2px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em;
                                background: {% if order.status == 'pendente' %}#FFFBEB; color: #B45309{% elif order.status == 'confirmado' %}#ECFDF5; color: #047857{% else %}#F3F4F6; color: #374151{% endif %};">
                                {{ order.get_status_display }}
                            </span>
                        </td>
                        <td
                            style="padding: 1rem 0; border-bottom: 1px solid #f1f1f1; text-align: right; font-weight: 700; color: #111;">
                            R$ {{ order.total_amount }}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" style="padding: 3rem; text-align: center; color: #a3a3a3;">
                            <i data-lucide="inbox"
                                style="width: 32px; height: 32px; opacity: 0.3; margin-bottom: 0.5rem;"></i>
                            <p>Nenhuma distribuição recente.</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Action Cards (Right column, stacked) -->
    <div class="flex flex-col gap-4">
        <!-- Top Row: Shared Space (50% each) -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
            <!-- Action Card 1: Inventário Rápido -->
            <a href="/stock/inventory/"
                class="card p-4 hover-lift flex flex-col items-center justify-center gap-2 hover-glow text-center"
                style="border: 1px solid #E5E5E5;">
                <div
                    style="background: #FFFBEB; padding: 0.5rem; border-radius: 2px; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;">
                    <i data-lucide="clipboard-list" style="color: #D4AF37; width: 18px;"></i>
                </div>
                <div>
                    <div style="font-weight: 700; font-size: 0.875rem;">Inventário</div>
                </div>
            </a>

            <!-- Action Card 2: Relatórios -->
            <a href="/reports/"
                class="card p-4 hover-lift flex flex-col items-center justify-center gap-2 hover-glow text-center"
                style="border: 1px solid #E5E5E5;">
                <div
                    style="background: #ECFDF5; padding: 0.5rem; border-radius: 2px; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;">
                    <i data-lucide="bar-chart-3" style="color: #059669; width: 18px;"></i>
                </div>
                <div>
                    <div style="font-weight: 700; font-size: 0.875rem;">Relatórios</div>
                </div>
            </a>
        </div>

        <!-- Contextual Help -->
        <div class="card p-4"
            style="background: #111; color: white; border-radius: 2px; position: relative; overflow: hidden;">
            <div
                style="position: absolute; right: -10px; top: -10px; width: 80px; height: 80px; background: rgba(212,175,55,0.2); border-radius: 50%; blur: 20px;">
            </div>
            <h4 style="font-weight: 700; margin-bottom: 0.5rem; position: relative; z-index: 2;">Precisa de suporte?
            </h4>
            <p style="font-size: 0.75rem; color: #AAA; margin-bottom: 1rem; position: relative; z-index: 2;">Acesse
                a documentação completa do sistema.</p>
            <button class="btn"
                style="width: 100%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white;">
                Abrir Manual
            </button>
        </div>
    </div>
</div>
</div>
{% endblock %}