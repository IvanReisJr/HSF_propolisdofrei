{% extends "base.html" %}

{% block title %}Produtos - Própolis do Frei{% endblock %}

{% block breadcrumbs %}
<a href="{% url 'dashboard' %}" class="hover:text-primary transition-colors"
    style="color: #a3a3a3; text-decoration: none;">Início</a> <span style="color: #a3a3a3;"> / </span> <span
    style="font-weight: 600;">Produtos</span>
{% endblock %}

{% block content %}
<div class="flex-col gap-6">
    <div class="flex justify-between items-center">
        <div>
            <h1 style="font-size: 1.875rem; font-weight: 700;">Produtos</h1>
            <p style="color: #666;">Gerencie o catálogo global de produtos do Hospital Santa Felícitas.</p>
        </div>
        <div class="flex gap-2">
            <a href="{% url 'packaging_list' %}" class="btn btn-outline">
                <i data-lucide="package"></i> Embalagens
            </a>
            <a href="{% url 'product_create' %}" class="btn btn-primary">
                <i data-lucide="plus"></i> Adicionar Produto
            </a>
        </div>
    </div>

    <!-- Filters Bar -->
    <div class="card flex items-center justify-between gap-4">
        <form method="get" class="flex items-center gap-4" style="flex: 1;">
            <div style="position: relative; flex: 1;">
                <i data-lucide="search"
                    style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); width: 18px; color: #a3a3a3;"></i>
                <input type="text" name="q" value="{{ query }}" class="input" style="padding-left: 40px;"
                    placeholder="Buscar por nome ou código...">
            </div>

            <select name="category" class="input" style="width: 200px;">
                <option value="">Todas Categorias</option>
                {% for category in categories %}
                <option value="{{ category.id }}" {% if selected_category == category.id|stringformat:"s" %}selected{% endif %}>{{ category.name }}</option>

                {% endfor %}
            </select>

            <select name="status" class="input" style="width: 150px;">
                <option value="all" {% if selected_status == 'all' %}selected{% endif %}>Todos</option>
                <option value="active" {% if selected_status == 'active' %}selected{% endif %}>Ativos</option>
                <option value="inactive" {% if selected_status == 'inactive' %}selected{% endif %}>Inativos</option>
            </select>

            <button type="submit" class="btn btn-outline">Filtrar</button>
        </form>
    </div>

    <!-- Products Table -->
    <div class="card" style="max-height: 320px; overflow-y: auto; overflow-x: hidden;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr
                    style="border-bottom: 1px solid var(--border); text-align: left; position: sticky; top: 0; background: white; z-index: 10;">
                    <th style="padding: 1rem; font-size: 0.875rem; color: #666;">Código</th>
                    <th style="padding: 1rem; font-size: 0.875rem; color: #666;">Nome</th>
                    <th style="padding: 1rem; font-size: 0.875rem; color: #666;">Categoria</th>
                    <th style="padding: 1rem; font-size: 0.875rem; color: #666;">Estoque Total</th>
                    <th style="padding: 1rem; font-size: 0.875rem; color: #666;">Preço</th>
                    <th style="padding: 1rem; font-size: 0.875rem; color: #666; text-align: right;">Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for product in products %}
                <tr style="border-bottom: 1px solid var(--sidebar-accent);">
                    <td style="padding: 1rem; font-family: monospace; font-weight: 600;">{{ product.code }}</td>
                    <td style="padding: 1rem;">
                        <div class="flex-col">
                            <span style="font-weight: 600;">{{ product.name }}</span>
                            <span style="font-size: 0.75rem; color: #a3a3a3;">{{ product.unit }}</span>
                        </div>
                    </td>
                    <td style="padding: 1rem;">{{ product.category.name }}</td>
                    <td style="padding: 1rem;">
                        <span
                            style="font-weight: 700; color: {% if product.get_total_stock < product.min_stock %}#ef4444{% else %}#22c55e{% endif %};">
                            {{ product.get_total_stock }}
                        </span>
                    </td>
                    <td style="padding: 1rem; font-weight: 600;">R$ {{ product.sale_price }}</td>
                    <td style="padding: 1rem; text-align: right;">
                        <div class="flex justify-end gap-2">
                            <a href="{% url 'product_detail' product.pk %}" class="btn btn-outline p-2"
                                title="Ver Detalhes">
                                <i data-lucide="eye" style="width: 18px;"></i>
                            </a>
                            <a href="{% url 'product_edit' product.pk %}" class="btn btn-outline p-2" title="Editar">
                                <i data-lucide="edit-2" style="width: 18px;"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" style="padding: 3rem; text-align: center; color: #a3a3a3;">
                        <i data-lucide="package-search"
                            style="width: 48px; height: 48px; display: block; margin: 0 auto 1rem; opacity: 0.3;"></i>
                        Nenhum produto encontrado.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}