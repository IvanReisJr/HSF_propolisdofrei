{% extends "base.html" %}

{% block title %}Pedido {{ order.order_number }} - Própolis do Frei{% endblock %}

{% block breadcrumbs %}
<span style="color: #a3a3a3;">Início / Pedidos / </span> <span style="font-weight: 600;">Detalhes</span>
{% endblock %}

{% block content %}
<div class="flex-col gap-6">
    <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
            <a href="{% url 'order_list' %}" class="btn btn-outline p-2">
                <i data-lucide="arrow-left"></i>
            </a>
            <div>
                <h1 style="font-size: 1.875rem; font-weight: 700;">Pedido {{ order.order_number }}</h1>
                <p style="color: #666;">Status: <span style="font-weight: 700; color: {% if order.status == 'pendente' %}#92400e{% elif order.status == 'confirmado' %}#166534{% else %}#b91c1c{% endif %};">{{ order.get_status_display }}</span></p>
            </div>
        </div>

        <div class="flex gap-2">
            {% if order.status == 'pendente' %}
            <form action="{% url 'order_cancel' order.pk %}" method="post">
                {% csrf_token %}
                <button type="submit" class="btn btn-outline" style="color: #ef4444; border-color: #fee2e2;">
                    <i data-lucide="x-circle"></i> Cancelar Pedido
                </button>
            </form>
            <form action="{% url 'order_confirm' order.pk %}" method="post">
                {% csrf_token %}
                <button type="submit" class="btn btn-primary">
                    <i data-lucide="check-circle-2"></i> Confirmar e Baixar Estoque
                </button>
            </form>
            {% endif %}

            {% if order.status == 'confirmado' %}
            <button class="btn btn-outline">
                <i data-lucide="printer"></i> Imprimir Comprovante
            </button>
            {% endif %}
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem;">
        <div class="card flex-col gap-4">
            <h3 style="font-size: 1.125rem; font-weight: 600;">Itens do Pedido</h3>
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="border-bottom: 1px solid var(--border); text-align: left;">
                        <th style="padding: 0.75rem 0; font-size: 0.875rem; color: #666;">Produto</th>
                        <th style="padding: 0.75rem 0; font-size: 0.875rem; color: #666; text-align: center;">Quantidade</th>
                        <th style="padding: 0.75rem 0; font-size: 0.875rem; color: #666; text-align: right;">Unitário</th>
                        <th style="padding: 0.75rem 0; font-size: 0.875rem; color: #666; text-align: right;">Subtotal</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in order.items.all %}
                    <tr style="border-bottom: 1px solid var(--sidebar-accent);">
                        <td style="padding: 1rem 0;">
                            <div class="flex-col">
                                <span style="font-weight: 600;">{{ item.product.name }}</span>
                                <span style="font-size: 0.75rem; color: #a3a3a3;">Código: {{ item.product.code }}</span>
                            </div>
                        </td>
                        <td style="padding: 1rem 0; text-align: center;">{{ item.quantity }} {{ item.product.unit }}</td>
                        <td style="padding: 1rem 0; text-align: right;">R$ {{ item.unit_price }}</td>
                        <td style="padding: 1rem 0; text-align: right; font-weight: 600;">R$ {{ item.total_price }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="3" style="padding: 1.5rem 0 0.5rem; text-align: right; color: #666;">Subtotal</td>
                        <td style="padding: 1.5rem 0 0.5rem; text-align: right; font-weight: 600;">R$ {{ order.total_amount }}</td>
                    </tr>
                    <tr>
                        <td colspan="3" style="padding: 0.5rem 0; text-align: right; font-size: 1.125rem; font-weight: 700;">Total Geral</td>
                        <td style="padding: 0.5rem 0; text-align: right; font-size: 1.125rem; font-weight: 700; color: var(--primary);">R$ {{ order.total_amount }}</td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <div class="flex-col gap-6">
            <div class="card flex-col gap-4">
                <h3 style="font-size: 1.125rem; font-weight: 600;">Destinatário</h3>
                <div class="flex-col gap-2">
                    <p style="font-weight: 600;">{{ order.distributor.name }}</p>
                    <p style="font-size: 0.875rem; color: #666;">{{ order.distributor.city }}, {{ order.distributor.state }}</p>
                    <p style="font-size: 0.875rem; color: #666;">{{ order.distributor.email }}</p>
                </div>
            </div>

            <div class="card flex-col gap-4">
                <h3 style="font-size: 1.125rem; font-weight: 600;">Informações de Envio</h3>
                <div class="flex justify-between">
                    <span style="color: #666; font-size: 0.875rem;">Saído de:</span>
                    <span style="font-weight: 600; font-size: 0.875rem;">{{ order.establishment.name }}</span>
                </div>
                <div class="flex justify-between">
                    <span style="color: #666; font-size: 0.875rem;">Criado em:</span>
                    <span style="font-weight: 600; font-size: 0.875rem;">{{ order.created_at|date:"d/m/Y H:i" }}</span>
                </div>
                {% if order.status == 'confirmado' %}
                <div class="flex justify-between">
                    <span style="color: #666; font-size: 0.875rem;">Confirmado em:</span>
                    <span style="font-weight: 600; font-size: 0.875rem;">{{ order.updated_at|date:"d/m/Y H:i" }}</span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
