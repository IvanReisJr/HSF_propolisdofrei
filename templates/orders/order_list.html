{% extends "base.html" %}

{% block title %}Pedidos de Distribuição - Própolis do Frei{% endblock %}

{% block breadcrumbs %}
<span style="color: #a3a3a3;">Início / </span> <span style="font-weight: 600;">Pedidos</span>
{% endblock %}

{% block content %}
<div class="flex-col gap-6">
    <div class="flex justify-between items-center">
        <div>
            <h1 style="font-size: 1.875rem; font-weight: 700;">Pedidos de Distribuição</h1>
            <p style="color: #666;">Controle o envio de produtos para distribuidores e parceiros.</p>
        </div>
        <a href="{% url 'order_create' %}" class="btn flex items-center gap-2 bg-amber-600 text-white hover:bg-amber-700 transition-colors shadow-sm" style="border: none;" hx-boost="false">
            <i data-lucide="plus-circle" style="width: 20px;"></i> Novo Pedido
        </a>
    </div>

    <!-- Status Tabs -->
    <div class="flex gap-4" style="border-bottom: 1px solid var(--border); padding-bottom: 0.5rem;">
        <a href="{% url 'order_list' %}"
            style="{% if status_filter == 'all' %}color: var(--primary); font-weight: 600; border-bottom: 2px solid var(--primary);{% else %}color: #666; font-weight: 500;{% endif %} padding-bottom: 0.5rem; cursor: pointer; text-decoration: none;">Todos</a>
        <a href="{% url 'order_list' %}?status=pendente"
            style="{% if status_filter == 'pendente' %}color: var(--primary); font-weight: 600; border-bottom: 2px solid var(--primary);{% else %}color: #666; font-weight: 500;{% endif %} padding-bottom: 0.5rem; cursor: pointer; text-decoration: none;">Pendentes</a>
        <a href="{% url 'order_list' %}?status=confirmado"
            style="{% if status_filter == 'confirmado' %}color: var(--primary); font-weight: 600; border-bottom: 2px solid var(--primary);{% else %}color: #666; font-weight: 500;{% endif %} padding-bottom: 0.5rem; cursor: pointer; text-decoration: none;">Confirmados</a>
        <a href="{% url 'order_list' %}?status=cancelado"
            style="{% if status_filter == 'cancelado' %}color: var(--primary); font-weight: 600; border-bottom: 2px solid var(--primary);{% else %}color: #666; font-weight: 500;{% endif %} padding-bottom: 0.5rem; cursor: pointer; text-decoration: none;">Cancelados</a>
    </div>

    <div class="card" style="max-height: 400px; overflow-y: auto; overflow-x: hidden;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr
                    style="border-bottom: 1px solid var(--border); text-align: left; position: sticky; top: 0; background: white; z-index: 10;">
                    <th style="padding: 1rem; font-size: 0.875rem; color: #666;">Nº Pedido</th>
                    <th style="padding: 1rem; font-size: 0.875rem; color: #666;">Data</th>
                    <th style="padding: 1rem; font-size: 0.875rem; color: #666;">Unidade Origem</th>
                    <th style="padding: 1rem; font-size: 0.875rem; color: #666;">Destino (Filial)</th>
                    <th style="padding: 1rem; font-size: 0.875rem; color: #666;">Total</th>
                    <th style="padding: 1rem; font-size: 0.875rem; color: #666;">Condição</th>
                    <th style="padding: 1rem; font-size: 0.875rem; color: #666;">Status</th>
                    <th style="padding: 1rem; font-size: 0.875rem; color: #666; text-align: right;">Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for order in orders %}
                <tr style="border-bottom: 1px solid var(--sidebar-accent);">
                    <td style="padding: 1rem; font-weight: 600; font-family: monospace;">{{ order.order_number }}</td>
                    <td style="padding: 1rem; font-size: 0.875rem;">{{ order.created_at|date:"d/m/Y" }}</td>
                    <td style="padding: 1rem;">{{ order.distributor.name }}</td>
                    <td style="padding: 1rem; color: #666;">{{ order.target_distributor.name }}</td>
                    <td style="padding: 1rem; font-weight: 600;">R$ {{ order.total_amount }}</td>
                    <td style="padding: 1rem;">
                        <span style="font-size: 0.875rem; color: #4b5563;">
                            {{ order.get_payment_condition_display }}
                        </span>
                    </td>
                    <td style="padding: 1rem;">
                        <span
                            style="padding: 0.25rem 0.5rem; border-radius: 99px; font-size: 0.75rem; font-weight: 600; 
                            background: {% if order.status == 'pendente' %}#fef3c7; color: #92400e{% elif order.status == 'confirmado' %}#dcfce7; color: #166534{% else %}#f3f4f6; color: #1f2937{% endif %};">
                            {{ order.get_status_display }}
                        </span>
                    </td>
                    <td style="padding: 1rem; text-align: right;">
                        <a href="{% url 'order_detail' order.pk %}" class="btn btn-outline p-2">
                            <i data-lucide="eye" style="width: 18px;"></i>
                        </a>
                        {% if order.status == 'confirmado' and order.payment_condition != 'doacao' and order.pending_balance > 0 %}
                        <a href="{% url 'upload_settlement' order.pk %}" class="btn btn-outline p-2 hover:bg-green-50 hover:text-green-600 hover:border-green-200" title="Prestar Contas">
                            <i data-lucide="dollar-sign" style="width: 18px;"></i>
                        </a>
                        {% endif %}
                        {% if order.status == 'pendente' or order.status == 'cancelado' %}
                        <a href="{% url 'order_delete' order.pk %}"
                            class="btn btn-outline p-2 hover:bg-red-50 hover:text-red-600 hover:border-red-200"
                            title="Excluir">
                            <i data-lucide="trash-2" style="width: 18px;"></i>
                        </a>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" style="padding: 3rem; text-align: center; color: #a3a3a3;">
                        <i data-lucide="shopping-cart"
                            style="width: 48px; height: 48px; display: block; margin: 0 auto 1rem; opacity: 0.3;"></i>
                        Nenhum pedido encontrado.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}